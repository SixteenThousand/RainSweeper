(()=>{"use strict";const e=["#00ffff","#0000ff","#00ff00","#ff0000","#00ffff","#ffff00","#ff00ff","#000000"],t="http://www.w3.org/2000/svg",n=new Event("incBombs"),s=new Event("decBombs"),i=new Event("incNumMapped"),l=new Event("decNumMapped"),a=new Event("incNumExploded");function d(e,t,n,s,i){let l=e,a=t,d="";for(let e=0;e<s;++e)d+=`${l},${a}`,e<s-1&&(d+=" "),l+=i*Math.cos(n+2*e*Math.PI/s),a+=i*Math.sin(n+2*e*Math.PI/s);return d}const o={SVGNS:t,RegularCell:class{constructor(e,n,s,i,l,a){let o=document.createElementNS(t,"polygon"),r=document.createElementNS(t,"polygon");this.cellSide=a*(1-.14*Math.sin(Math.PI/l)),o.setAttribute("points",d(n,s,i,l,a)),r.setAttribute("points",d(n+.07*a*Math.sin(Math.PI/l-i),s+.07*a*Math.cos(Math.PI/l-i),i,l,this.cellSide)),o.setAttribute("fill","transparent"),r.setAttribute("fill","white"),this.boundShape=o,this.cellShape=r,this.boundSide=a,this.numSides=l,this.svgcanvas=e,this.centreX=n+a*Math.sin(Math.PI/l-i)/(2*Math.sin(Math.PI/l)),this.centreY=s+a*Math.cos(Math.PI/l-i)/(2*Math.sin(Math.PI/l)),this.radius=this.cellSide/Math.tan(Math.PI/l),this.isBomb=!1,this.numAdjBombs=0,this.isRevealed=!1,this.isFlagged=!1,this.flagImage=document.createElementNS(t,"image"),this.flagImage.setAttribute("x",(this.centreX-.5*this.radius).toString()),this.flagImage.setAttribute("y",(this.centreY-.5*this.radius).toString()),this.flagImage.setAttribute("width",this.radius.toString()),this.flagImage.setAttribute("height",this.radius.toString()),this.flagImage.setAttribute("href","./assets/umbrella-alt.svg"),this.cellShape.addEventListener("click",(e=>{0===e.button&&this.reveal()})),this.cellShape.addEventListener("contextmenu",(e=>{this.toggleFlag(e)})),this.flagImage.addEventListener("contextmenu",(e=>{this.toggleFlag(e)})),e.appendChild(o),e.appendChild(r)}setBomb(){this.isBomb=!0}incNumAdjBombs(){++this.numAdjBombs}toggleFlag(e){e.preventDefault(),this.isRevealed||(this.isFlagged?(document.dispatchEvent(n),document.dispatchEvent(l),this.svgcanvas.removeChild(this.flagImage)):(document.dispatchEvent(s),document.dispatchEvent(i),this.svgcanvas.appendChild(this.flagImage)),this.isFlagged=!this.isFlagged)}reveal(){if(!this.isFlagged&&!this.isRevealed)if(this.isRevealed=!0,document.dispatchEvent(i),this.isBomb){document.dispatchEvent(s),document.dispatchEvent(a),this.cellShape.setAttribute("opacity","0.2");let e=document.createElementNS(t,"image");e.setAttribute("x",(this.centreX-.5*this.radius).toString()),e.setAttribute("y",(this.centreY-.5*this.radius).toString()),e.setAttribute("width",this.radius.toString()),e.setAttribute("height",this.radius.toString()),e.setAttribute("href","./assets/raincloud.svg"),this.svgcanvas.appendChild(e)}else{let n,s=document.createElementNS(t,"text");n=this.numAdjBombs<e.length?e[this.numAdjBombs]:e[e.length-1],s.setAttribute("fill",n),s.setAttribute("x",this.centreX.toString()),s.setAttribute("y",this.centreY.toString()),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","middle"),s.setAttribute("font-size",Math.ceil(.5*this.cellSide).toString()),s.setAttribute("font-family","Arial");let i=document.createTextNode(this.numAdjBombs.toString());s.appendChild(i),this.svgcanvas.appendChild(s)}}}},r=o,u={CellGroup:class{constructor(e,t,n,s){this.cellsInfo=e,this.numCells=e.length,this.dx=t,this.dy=n,this.groupPadding=s}draw(e,t,n,s){let i,l=[];for(let a of this.cellsInfo)i=Math.PI*(.5-1/a.numSides),l[l.length]=new r.RegularCell(e,t+s*a.x,n+s*a.y,a.angle,a.numSides,s);return l}},Board:class{constructor(e,t,n,s,i,l){this.cells=[],this.boundSide=t,this.numCellsInGroup=n.numCells;let a=n.groupPadding*t,d=n.groupPadding*t;for(let l=0;l<s;++l)for(let s=0;s<i;++s)this.cells=this.cells.concat(n.draw(e,a+s*n.dx*t,d+l*n.dy*t,t));this.height=t*(n.dy*s+2*n.groupPadding),this.width=t*(n.dx*i+2*n.groupPadding),this.numBombs=l,document.addEventListener("click",(e=>{let t,n=[],s=[...this.cells.keys()],i=0;for(;i<s.length&&this.cells[i].cellShape!==e.target;)++i;s.splice(i,1);for(let e=0;e<l;++e)t=Math.floor(s.length*Math.random()),n.push(s[t]),s.splice(t,1);for(let e of n){this.cells[e].setBomb();for(let t=0;t<this.cells.length;++t)t!==e&&this.areAdjacent(e,t)&&this.cells[t].incNumAdjBombs()}}),{once:!0,capture:!0})}approxEqual(e,t){let[n,s]=e.split(",").map(parseFloat),[i,l]=t.split(",").map(parseFloat);return(n-i)**2+(s-l)**2<.4*this.boundSide}areAdjacent(e,t){if(this.cells[e]===this.cells[t])return!1;let n=this.numCols*this.numCellsInGroup,s=Math.trunc(e/n),i=Math.trunc(t/n),l=Math.trunc(e%n/this.numCellsInGroup),a=Math.trunc(t%n/this.numCellsInGroup);if(Math.abs(s-i)>1||Math.abs(l-a)>1)return!1;let d=this.cells[e].boundShape.getAttribute("points").split(" "),o=this.cells[t].boundShape.getAttribute("points").split(" ");for(let e=0;e<d.length;++e)for(let t=0;t<o.length;++t)if(this.approxEqual(d[e],o[t]))return!0;return!1}isWon(){for(let e of this.cells)if(!e.isRevealed&&!e.isBomb)return!1;return!0}}},h=u,c=Math.sqrt(2),g=Math.sqrt(3),m=Math.sqrt(.75),p=[{x:0,y:0,angle:0,numSides:8},{x:1+.5*c,y:.5*c,angle:0,numSides:4},{x:0,y:1+c,angle:0,numSides:4},{x:1+.5*c,y:1+.5*c,angle:0,numSides:8}],S=new h.CellGroup(p,2+c,2+c,1),f=[{x:0,y:0,angle:0,numSides:6},{x:1.5,y:m,angle:0,numSides:6}],v=new h.CellGroup(f,3,2*m,.8),b=[{x:0,y:0,angle:0,numSides:3},{x:.5,y:m,angle:-Math.PI/3,numSides:3},{x:.5,y:m,angle:0,numSides:3},{x:.5,y:m,angle:Math.PI/3,numSides:3}],y=new h.CellGroup(b,1,2*m,.6),M=[{x:0,y:0,angle:0,numSides:3},{x:1,y:0,angle:0,numSides:6},{x:.5,y:m,angle:Math.PI/3,numSides:3},{x:0,y:2*m,angle:0,numSides:6},{x:1,y:2*m,angle:0,numSides:3},{x:1.5,y:3*m,angle:Math.PI/3,numSides:3}],E=new h.CellGroup(M,2,4*m,.6),x=[{x:0,y:0,angle:0,numSides:12},{x:.5*(2+g),y:.5*(3+2*g),angle:0,numSides:4},{x:.5*(3+g),y:.5*(3+g),angle:Math.PI/3,numSides:3},{x:.5*(2+g),y:.5*(5+2*g),angle:0,numSides:3},{x:.5*(2+g),y:.5*(3+2*g),angle:Math.PI/2,numSides:3},{x:-.5*g,y:.5*(3+2*g),angle:Math.PI/6,numSides:3}],I={"Squares & Octagons":{groupType:S,sizes:[[3,3],[3,4],[4,4],[4,6],[5,5]]},"All Hexagons":{groupType:v,sizes:[[3,3],[5,5],[6,6],[10,10],[12,15]]},"All Triangles":{groupType:y,sizes:[[5,5],[10,10],[20,15]]},"The Six-Pointed Star":{groupType:E,sizes:[[3,4],[3,5],[3,6],[5,7]]},"The Twelve-Pointed Star":{groupType:new h.CellGroup(x,2+g,2+g,1.5),sizes:[[3,3],[3,5],[5,7],[5,10]]}};let A,C=0;function B(){return Math.trunc(C/A*100).toString().concat("%")}let w=document.createTextNode(B());document.getElementById("pcMapped-state").appendChild(w),document.addEventListener("incNumMapped",(e=>{++C,w.nodeValue=B(),k.isWon()&&alert("You Win!\nYou can start a new game using the menu above")})),document.addEventListener("decNumMapped",(e=>{--C,w.nodeValue=B()}));let N=0;function P(){let e=Math.abs(N).toString();return"".concat(N<0?"-":" ",e)}let T=document.createTextNode(P());document.getElementById("numBombs-state").appendChild(T),document.addEventListener("incBombs",(e=>{++N,T.nodeValue=P()})),document.addEventListener("decBombs",(e=>{--N,T.nodeValue=P()}));let G=0,L=document.createTextNode(G.toString());document.getElementById("numExploded-state").appendChild(L),document.addEventListener("incNumExploded",(e=>{++G,L.nodeValue=G.toString()}));const V=document.getElementById("Mode-Selector");let F,j;for(const e in I)F=document.createElement("option"),j=document.createTextNode(e),F.appendChild(j),V.appendChild(F);const z=document.getElementById("size-Selector");V.addEventListener("change",(function(e){for(;z.children.length>0;)z.children[0].remove();let t,n,s;for(let e of I[V.value].sizes)t=document.createElement("option"),s=e[0]*e[1]*I[V.value].groupType.numCells,n=document.createTextNode(`${s} clouds`),t.value=e,t.appendChild(n),z.appendChild(t)}));const q=document.getElementById("numBombs-Selector");function R(e){let t=z.value.split(",").map((e=>parseInt(e))).reduce(((e,t)=>e*t),1)*I[V.value].groupType.numCells;q.max=t.toString(),q.value=Math.round(t/6)}let Y,k;z.addEventListener("change",R),V.addEventListener("change",R),document.getElementById("New-Game").addEventListener("click",(e=>{void 0!==Y&&Y.remove(),Y=document.createElementNS(r.SVGNS,"svg");const t=z.value.split(",").map((e=>parseInt(e)));k=new h.Board(Y,40,I[V.value].groupType,t[0],t[1],parseInt(q.value)),N=parseInt(q.value),T.nodeValue=P(),A=k.cells.length,C=0,w.nodeValue=B(),Y.setAttribute("height",k.height.toString()),Y.setAttribute("width",k.width.toString()),document.getElementById("game-container").appendChild(Y)})),Y=document.createElementNS(r.SVGNS,"svg"),k=new h.Board(Y,40,I["Squares & Octagons"].groupType,4,6,16),N=16,T.nodeValue=P(),A=k.cells.length,w.nodeValue=B(),Y.setAttribute("height",k.height.toString()),Y.setAttribute("width",k.width.toString()),document.getElementById("game-container").appendChild(Y)})();